from yacs.config import CfgNode as CN

def show_cfg(cfg):
    dump_cfg = CN()
    dump_cfg.EXPERIMENT = cfg.EXPERIMENT
    dump_cfg.DATASET = cfg.DATASET
    dump_cfg.SOURCE_DATASET = cfg.SOURCE_DATASET
    dump_cfg.FINETUNE = cfg.FINETUNE
    dump_cfg.DISTILLER = cfg.DISTILLER
    dump_cfg.ADAPTER = cfg.ADAPTER
    dump_cfg.SOLVER = cfg.SOLVER
    print(dump_cfg.dump())


CFG = CN()
############################## TLK Global Setting ##########################
# Experiment
CFG.EXPERIMENT = CN()
CFG.EXPERIMENT.PROJECT = "TLK"
CFG.EXPERIMENT.TAG = "default"
CFG.EXPERIMENT.STRATEGY = "OnlyFinetuneStrategy"
CFG.EXPERIMENT.MODEL_SAVE = "/home/vmagent/app/dataset/model/"
CFG.EXPERIMENT.MODEL_SAVE_INTERVASL = 40
CFG.EXPERIMENT.LOG_INTERVAL_STEP = 10
CFG.EXPERIMENT.LOSS = CN()
CFG.EXPERIMENT.LOSS.BACKBONE = 1.0
CFG.EXPERIMENT.LOSS.DISTILLER = 0.0
CFG.EXPERIMENT.LOSS.ADAPTER = 0.0

# Dataset
CFG.DATASET = CN()
CFG.DATASET.TYPE = "NONE"
CFG.DATASET.PATH = "NONE"
CFG.DATASET.NUM_WORKERS = 2
CFG.DATASET.VAL = CN()
CFG.DATASET.VAL.BATCH_SIZE = 64
CFG.DATASET.TEST = CN()
CFG.DATASET.TEST.BATCH_SIZE = 64

# Dataset - source
CFG.SOURCE_DATASET = CN()
CFG.SOURCE_DATASET.TYPE = "NONE"
CFG.SOURCE_DATASET.PATH = "NONE"
CFG.SOURCE_DATASET.NUM_WORKERS = 2
CFG.SOURCE_DATASET.VAL = CN()
CFG.SOURCE_DATASET.VAL.BATCH_SIZE = 64
CFG.SOURCE_DATASET.TEST = CN()
CFG.SOURCE_DATASET.TEST.BATCH_SIZE = 64

# Model
CFG.MODEL = CN()
CFG.MODEL.TYPE = "resnet18_v2"
CFG.MODEL.PRETRAIN = "NONE"   #None, "pretrain" - default pretrain model, path
 
# Finetune
CFG.FINETUNE = CN()
CFG.FINETUNE.TYPE = "NONE"

# Distiller
CFG.DISTILLER = CN()
CFG.DISTILLER.TYPE = "NONE"  # Vanilla as default
CFG.DISTILLER.TEACHER = CN()
CFG.DISTILLER.TEACHER.TYPE = "resnet50_v2"
CFG.DISTILLER.TEACHER.PRETRAIN = "NONE"
CFG.DISTILLER.TEACHER.IS_FROZEN = True

# Transfer
CFG.ADAPTER = CN()
CFG.ADAPTER.TYPE = "NONE"
CFG.ADAPTER.FEATURE_SIZE = 500
CFG.ADAPTER.FEATURE_LAYER_NAME = "NONE"

# Solver
CFG.SOLVER = CN()
CFG.SOLVER.BATCH_SIZE = 64
CFG.SOLVER.EPOCHS = 240
CFG.SOLVER.LR = 0.05
CFG.SOLVER.LR_DECAY_STAGES = "NONE"
CFG.SOLVER.LR_DECAY_RATE = 0.1
CFG.SOLVER.WEIGHT_DECAY = 0.0001
CFG.SOLVER.MOMENTUM = 0.9
CFG.SOLVER.TYPE = "SGD"
CFG.SOLVER.EARLY_STOP = CN()
CFG.SOLVER.EARLY_STOP.FLAG = True

######################## For Distiller #####################
# KD CFG
CFG.KD = CN()
CFG.KD.TEMPERATURE = 4

# DKD(Decoupled Knowledge Distillation) CFG
CFG.DKD = CN()
CFG.DKD.ALPHA = 1.0
CFG.DKD.BETA = 8.0
CFG.DKD.T = 4.0
CFG.DKD.WARMUP = 20